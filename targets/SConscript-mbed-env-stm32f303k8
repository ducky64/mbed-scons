"""Shared environment variable defines for platform-specific compiles.
Includes the base mbed environment on GCC.

WARNING! ST's code relies heavily on weak symbols, which doesn't play well with
the default linker behavior. It's necessary to manually include the mbed
library using --Wl,--whole-archive using linker flags.
"""

Import('env')
SConscript('SConscript-mbed-env-gcc', exports='env')
SConscript('SConscript-mbed-env-cortexm4', exports='env')

env.Append(MBED_TARGET = [
  'TARGET_STM',
  'TARGET_STM32F3',
  'TARGET_STM32F303K8',
  'TARGET_NUCLEO_F303K8',

  'TARGET_FF_ARDUINO',
])

env.Append(CPPDEFINES = env['MBED_TARGET'])

if 'MBED_LIB_LINKSCRIPTS_ROOT' in env:
  env.Append(LINKFLAGS = [
    '-T$MBED_LIB_LINKSCRIPTS_ROOT/targets/cmsis/TARGET_STM/TARGET_STM32F3/TARGET_NUCLEO_F303K8/TOOLCHAIN_GCC_ARM/STM32F303X8.ld',
  ])
